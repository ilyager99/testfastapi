# testfastapi

Этот проект представляет собой набор автоматических тестов для сервиса FastAPI, включающий тесты:

* Аутентификации пользователей (test_auth.py)
* Кеширования данных (test_cache.py)
* Работы с базой данных (test_database.py)
* Основного приложения (test_main.py)
* Репозитория ссылок (test_repository.py)
* API роутера (test_router.py)
```
test_auth.py        # Тесты аутентификации
test_cache.py       # Тесты кеширования
test_database.py    # Тесты моделей БД
test_main.py        # Тесты основного приложения
test_repository.py  # Тесты репозитория
test_router.py      # Тесты API эндпоинтов
```

# Уставновка зависимостей 
```
pip install -r requirements.txt
```
# Запуск всех тестов
```
pytest -v
```

# Информация о тестах test_auth.py

## Тесты аутентификации (test_auth.py)
* Регистрация новых пользователей
* Аутентификация
* Генерация токенов
* Проверка прав доступа

## Тесты кеширования (test_cache.py)
* Сохранение/получение URL
* Работа со статистикой
* Проверка времени жизни кеша

## Тесты базы данных (test_database.py)
* Создание/удаление таблиц
* CRUD-операции с пользователями
* CRUD-операции с ссылками

## Тесты репозитория (test_repository.py)
* Генерация коротких кодов
* Нормализация URL
* Удаление просроченных ссылок

## Тесты API (test_router.py)
* Создание коротких ссылок
* Редиректы
* Статистика переходов
* Обновление/удаление ссылок

## test_generate_user_secret_key
Проверяет корректность генерации секретного ключа пользователя.

## test_register_user_success
Проверяет успешную регистрацию нового пользователя.

## test_register_user_existing
Проверяет обработку попытки регистрации уже существующего пользователя.

## test_authenticate_user_success
Проверяет успешную аутентификацию пользователя.

## test_authenticate_user_fail
Проверяет обработку неверных учетных данных.

## test_get_current_user_valid_token
Проверяет получение пользователя по валидному токену.

## test_get_current_user_invalid_token
Проверяет обработку невалидного токена.

## test_login_for_token
Проверяет работу эндпоинта /auth/token

## test_register_endpoint
Проверяет работу эндпоинта /auth/register.

# Информация о тестах test_cache.py

## test_get_set_cached_url
Проверяет сохранение, получение и удаление URL из кеша.

## test_get_set_cached_stats
Проверяет сохранение, получение и удаление статистики из кеша.

## test_cache_expiration
Проверяет истечение срока действия данных в кеше.

## mock_redis
Создает имитацию Redis-сервера (fakeredis.FakeRedis) для тестов.

# Информация о тестах test_database.py

## test_create_and_drop_tables
Проверяет создание и удаление таблиц в базе данных.

## test_user_model
Проверяет сохранение и извлечение данных модели UserOrm.

## test_link_model
Проверяет сохранение и извлечение данных модели LinkOrm.

# Информация о тестах test_database.py
проверяют корректность работы с базой данных

## test_create_and_drop_tables
Проверяет: 
* Корректное создание таблиц users и links
* Полное удаление таблиц после выполнения

## test_user_model
Проверяет: 
* Сохранение пользователя в базу данных
* Корректное извлечение данных пользователя
* Сохранение полей username и password_hash

## test_link_model
Проверяет: 
* Сохранение ссылки в базу данных
* Корректное извлечение данных ссылки
* Значения полей по умолчанию (click_count=0, user_id=None)
* Сохранение полей original_url и short_code

# Информация о тестах test_main.py

## test_app_lifespan
Проверяет:
* Доступность документации API Swagger
* Корректный запуск приложения

## test_auth_router
Проверяет: 
* Работу эндпоинта /auth/token
* Обработку успешной (200) и неудачной (401) аутентификации

## test_links_router
Проверяет: 
* Работу эндпоинта создания ссылок
* Обработку успешного (200) и запрещенного (403) запросов

# Информация о тестах test_repository.py

## test_generate_short_code
Проверяет:
* Длина кода составляет 8 символов
* Код содержит только буквы и цифры

## test_normalize_url
Проверяет: 
* Приведение к нижнему регистру
* Декодирование URL-encoded символов
* Сохранение структуры URL

## test_add_one_with_custom_alias
Проверяет: 
* Корректное сохранение ссылки с указанным алиасом
* Вызов операции добавления в БД
* Возврат объекта с правильным short_code

## test_add_one_with_existing_alias
Проверяет: 
* Вызов исключения HTTPException с кодом 400
* Обработку случая существующего алиаса

## test_find_by_short_code
Проверяет:
* Корректное извлечение ссылки из БД
* Соответствие short_code запрошенному

## test_increment_click_count
Проверяет:
* Выполнение SQL-запроса на обновление
* Корректную работу с сессией БД

## test_delete_expired_links
Проверяет:
* Выполнение операции удаления
* Корректную работу с сессией БД

# Информация о тестах test_router.py

## test_search_link_by_original_url
Проверяет:
* Статус код 200 при успешном поиске
* Наличие оригинального URL в ответе
* Наличие короткого URL в ответе

## test_shorten_link_authenticated
Проверяет:
* Статус код 200 при успешном создании
* Связь ссылки с пользователем (user_id=1)
* Работу с заголовком Authorization

## test_shorten_link_unauthenticated
Проверяет:
* Создание ссылок без авторизации
* Отсутствие user_id в ответе

## test_redirect_link
Проверяет:
* Код редиректа 307
* Правильный Location в заголовках
* Увеличение счетчика кликов

## test_delete_link_authenticated
Проверяет:
* Удаление только своих ссылок
* Статус код 200 при успехе
* Формат ответа {"ok": True}

## test_update_link
Проверяет:
* Изменение оригинального URL
* Проверку прав доступа
* Формат ответа

## test_link_stats
Проверяет:
* Данные о количестве переходов
* Наличие временных меток
* Формат ответа



































































































 







